<!DOCTYPE html>
    <head>
        <meta charset = "UTF-8">
        <meta name = "Description" content = "Cristian D. Conte - Computer Engineer">
        <meta name = "viewport" content = "width=device-width, initial-scale=1.0">
        <title>Cristian D. Conte</title>
    
        <script async type="module" src="./dsa/doubly_linked_list.js"></script>
        <script async type="module" src="./algorithms/linear.js"></script>
        
		<!-- Preload resources -->
		<link rel = "preload" href = "./index.css" as = "style"/>

		<!-- Load the stylesheets -->
		<link rel = "stylesheet" type = "text/css" href = "./index.css"/>
    </head>

    <body>
        <div id = "page1"></div>
        <div id = "page3"></div>
    </body>
</html>

<script type = "module">
    import {
        DoublyLinkedList,
    } from "./dsa/doubly_linked_list.js";

    import {
        IterableArray,
    } from "./dsa/iterable_array.js";

    import {
        linear 
    } from "./algorithms/linear.js";

    import {
        swap,
        shuffle, 
        quicksort,
        LESSER_FLAG,
        HIGHER_FLAG,
        EQUAL_FLAG,
    } from "./algorithms/sorting.js";

    window.addEventListener("load", () => {
        //Create page 1 elements
        const page1_name_arr = "Cristian D. Conte".split("");
        const page1_title_arr = "Computer Engineer".split("");
        let page1_els_arr = page1_name_arr.concat(page1_title_arr);

        let create_el_fun = (el_str, idx) => {
            let p_el = document.createElement("p");

            p_el.className = "page1_name_char_p";

            p_el.setAttribute("data-idx", idx);
            p_el.setAttribute("data-delta-x", 0);
            p_el.setAttribute("data-delta-y", 0);
            p_el.setAttribute("data-init-pos-x", "-");
            p_el.setAttribute("data-init-pox-y", "-");

            p_el.innerText = el_str;

            return p_el;
        }; // TODO: Create factories for turning data into visual elements

        let page1_els = linear(page1_els_arr, create_el_fun);
        
        //Create page 1 effects
        const custom_swap_shuffling = (arr, i, j) => {
            swap(arr, i, j);
        };

        let milliseconds = 0;
        let increase = 100;
        const custom_swap_sorting = (arr, i, j) => {
            if(i == j) return;
            
            const arr_i = arr[i];
            const arr_j = arr[j];

            let arr_i_pos, arr_j_pos;

            if(arr_i.getAttribute("data-init-pos-x") == "-") {
                arr_i_pos = arr_i.getBoundingClientRect();
                arr_i.setAttribute("data-init-pos-x", arr_i_pos.x);
                arr_i.setAttribute("data-init-pos-y", arr_i_pos.y);
            } else {
                arr_i_pos = {
                    x: Number.parseInt(arr_i.getAttribute("data-init-pos-x")),
                    y: Number.parseInt(arr_i.getAttribute("data-init-pos-y")),
                }
            }

            if(arr_j.getAttribute("data-init-pos-x") == "-") {
                arr_j_pos = arr_j.getBoundingClientRect();
                arr_j.setAttribute("data-init-pos-x", arr_j_pos.x);
                arr_j.setAttribute("data-init-pos-y", arr_j_pos.y);
            } else {
                arr_j_pos = {
                    x: Number.parseInt(arr_j.getAttribute("data-init-pos-x")),
                    y: Number.parseInt(arr_j.getAttribute("data-init-pos-y")),
                }
            }

            const arr_i_old_delta_x = Number.parseInt(arr_i.getAttribute("data-delta-x"));
            const arr_i_old_delta_y = Number.parseInt(arr_i.getAttribute("data-delta-y"));
            const arr_j_old_delta_x = Number.parseInt(arr_j.getAttribute("data-delta-x"));
            const arr_j_old_delta_y = Number.parseInt(arr_j.getAttribute("data-delta-y"));
            
            const delta_x = Math.round(arr_i_pos.x + arr_i_old_delta_x - arr_j_pos.x - arr_j_old_delta_x);
            const delta_y = Math.round(arr_i_pos.y + arr_i_old_delta_y - arr_j_pos.y - arr_j_old_delta_y);

            const arr_i_transform = `translate3d(${arr_i_old_delta_x - delta_x}px, ${arr_i_old_delta_y - delta_y}px, 0px)`;
            const arr_j_transform = `translate3d(${arr_j_old_delta_x + delta_x}px, ${arr_j_old_delta_y + delta_y}px, 0px)`;
            
            arr_i.setAttribute("data-delta-x", arr_i_old_delta_x - delta_x);
            arr_i.setAttribute("data-delta-y", arr_i_old_delta_y - delta_y);
            arr_j.setAttribute("data-delta-x", arr_j_old_delta_x + delta_x);
            arr_j.setAttribute("data-delta-y", arr_j_old_delta_y + delta_y);

            swap(arr, i, j);

            milliseconds += increase; //TODO: add a proper easing
            //increase -= 1;

            setTimeout(() => {
                arr_i.style.transform = arr_i_transform;
                arr_j.style.transform = arr_j_transform;
            }, milliseconds);
        };

        shuffle(page1_els, custom_swap_shuffling);
        
        linear(page1_els, (el) => document.getElementById("page1").appendChild(el));
        
        quicksort(
            page1_els,
            (el1, el2) => {
                const el1_idx = Number.parseInt(el1.getAttribute("data-idx"));
                const el2_idx = Number.parseInt(el2.getAttribute("data-idx"));

                return el1_idx < el2_idx ? LESSER_FLAG : HIGHER_FLAG;
            },
            custom_swap_sorting,
            0, 
            page1_els.length - 1
        );
        

        // Create page 2 elements
        const experiences_arr = [
            {
                value: ["Professional Experience"] // FIRST NODE
            }, 
            {
                value: ["2016", "I.T. Technician", "S.i.c.o.t. S.R.L."] 
            }, 
            {
                value: ["2017", "I.T. Technician", "Lugo Town Hall"] 
            }, 
            {
                value: ["2022", "Web Developer", "Il BuonLatte"] 
            }, 
            {
                value: ["2023", "AI / ML Engineer Intern", "SpecialVideo S.R.L."] 
            },
            {
                value: ["Null"] // LAST NODE
            }
        ];

        let head = null;
        let curr_node = null;
        const create_linked_list = (el) => {
            const new_node = new DoublyLinkedList(el.value);

            if(!head) {
                head = new_node;
                curr_node = head;
                return;
            }

            const tmp = curr_node;
            curr_node._next = new_node;
            curr_node = new_node;
            curr_node._prev = tmp;
        }; // TODO: turn this into a proper factory
        
        const create_visual_node = (node) => {
            let div_el = document.createElement("div");

            for(const val of node.value) {
                let p_el = document.createElement("p");

                p_el.className = "experiences_node_internal_p";
                p_el.innerText = val;

                div_el.appendChild(p_el);
            }

            return div_el;
        }; // TODO: turn this into a proper factory

        let test_arr = new IterableArray(experiences_arr);  
        test_arr.iterate(create_linked_list);
        
        //linear(experiences_arr, create_linked_list);
        
        head.iterate((el, idx) => console.log(el, idx));
        
    });
</script>
